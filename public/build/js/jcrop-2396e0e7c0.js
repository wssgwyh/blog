!function(t){"use strict";var e=function(r,n){var i=navigator.userAgent.toLowerCase();this.opt=t.extend({},e.defaults,n||{}),this.container=t(r),this.opt.is_msie=/msie/.test(i),this.opt.is_ie_lt9=/msie [1-8]\./.test(i),this.container.addClass(this.opt.css_container),this.ui={},this.state=null,this.ui.multi=[],this.ui.selection=null,this.filter={},this.init(),this.setOptions(n),this.applySizeConstraints(),this.container.trigger("cropinit",this),this.opt.is_ie_lt9&&(this.opt.dragEventTarget=document.body)};t.extend(e,{component:{},filter:{},stage:{},registerComponent:function(t,r){e.component[t]=r},registerFilter:function(t,r){e.filter[t]=r},registerStageType:function(t,r){e.stage[t]=r},attach:function(e,r){var n=new t.Jcrop(e,r);return n},imgCopy:function(t){var e=new Image;return e.src=t.src,e},imageClone:function(r){return t.Jcrop.supportsCanvas?e.canvasClone(r):e.imgCopy(r)},canvasClone:function(e){var r=document.createElement("canvas"),n=r.getContext("2d");return t(r).width(e.width).height(e.height),r.width=e.naturalWidth,r.height=e.naturalHeight,n.drawImage(e,0,0,e.naturalWidth,e.naturalHeight),r},propagate:function(t,e,r){for(var n=0,i=t.length;i>n;n++)e.hasOwnProperty(t[n])&&(r[t[n]]=e[t[n]])},getLargestBox:function(t,e,r){return e/r>t?[r*t,r]:[e,e/t]},stageConstructor:function(r,n,i){var o=[];t.each(e.stage,function(t,e){o.push(e)}),o.sort(function(t,e){return t.priority-e.priority});for(var a=0,s=o.length;s>a;a++)if(o[a].isSupported(r,n)){o[a].create(r,n,function(t,e){"function"==typeof i&&i(t,e)});break}},supportsColorFade:function(){return t.fx.step.hasOwnProperty("backgroundColor")},wrapFromXywh:function(t){var e={x:t[0],y:t[1],w:t[2],h:t[3]};return e.x2=e.x+e.w,e.y2=e.y+e.h,e}});var r=function(){};t.extend(r,{isSupported:function(t,e){return!0},priority:100,create:function(t,e,n){var i=new r;i.element=t,n.call(this,i,e)},prototype:{attach:function(t){this.init(t),t.ui.stage=this},triggerEvent:function(e){return t(this.element).trigger(e),this},getElement:function(){return this.element}}}),e.registerStageType("Block",r);var i=function(){};i.prototype=new r,t.extend(i,{isSupported:function(t,e){return"IMG"==t.tagName||void 0},priority:90,create:function(e,r,n){t.Jcrop.component.ImageLoader.attach(e,function(o,a){var s=new i;s.element=t(e).wrap("<div />").parent(),s.element.width(o).height(a),s.imgsrc=e,"function"==typeof n&&n.call(this,s,r)})}}),e.registerStageType("Image",i);var o=function(){this.angle=0,this.scale=1,this.scaleMin=.2,this.scaleMax=1.25,this.offset=[0,0]};o.prototype=new i,t.extend(o,{isSupported:function(e,r){return!(!t.Jcrop.supportsCanvas||"IMG"!=e.tagName)||void 0},priority:60,create:function(e,r,n){var i=t(e),a=t.extend({},r);t.Jcrop.component.ImageLoader.attach(e,function(t,r){var s=new o;i.hide(),s.createCanvas(e,t,r),i.before(s.element),s.imgsrc=e,a.imgsrc=e,"function"==typeof n&&(n(s,a),s.redraw())})}}),t.extend(o.prototype,{init:function(t){this.core=t},setOffset:function(t,e){return this.offset=[t,e],this},setAngle:function(t){return this.angle=t,this},setScale:function(t){return this.scale=this.boundScale(t),this},boundScale:function(t){return t<this.scaleMin?t=this.scaleMin:t>this.scaleMax&&(t=this.scaleMax),t},createCanvas:function(e,r,n){this.width=r,this.height=n,this.canvas=document.createElement("canvas"),this.canvas.width=r,this.canvas.height=n,this.$canvas=t(this.canvas).width("100%").height("100%"),this.context=this.canvas.getContext("2d"),this.fillstyle="rgb(0,0,0)",this.element=this.$canvas.wrap("<div />").parent().width(r).height(n)},triggerEvent:function(t){return this.$canvas.trigger(t),this},clear:function(){return this.context.fillStyle=this.fillstyle,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this},redraw:function(){return this.context.save(),this.clear(),this.context.translate(parseInt(.5*this.width),parseInt(.5*this.height)),this.context.translate(this.offset[0]/this.core.opt.xscale,this.offset[1]/this.core.opt.yscale),this.context.rotate(this.angle*(Math.PI/180)),this.context.scale(this.scale,this.scale),this.context.translate(-parseInt(.5*this.width),-parseInt(.5*this.height)),this.context.drawImage(this.imgsrc,0,0,this.width,this.height),this.context.restore(),this.$canvas.trigger("cropredraw"),this},setFillStyle:function(t){return this.fillstyle=t,this}}),e.registerStageType("Canvas",o);var a=function(){this.minw=40,this.minh=40,this.maxw=0,this.maxh=0,this.core=null};t.extend(a.prototype,{tag:"backoff",priority:22,filter:function(t){var e=this.bound;return t.x<e.minx&&(t.x=e.minx,t.x2=t.w+t.x),t.y<e.miny&&(t.y=e.miny,t.y2=t.h+t.y),t.x2>e.maxx&&(t.x2=e.maxx,t.x=t.x2-t.w),t.y2>e.maxy&&(t.y2=e.maxy,t.y=t.y2-t.h),t},refresh:function(t){this.elw=t.core.container.width(),this.elh=t.core.container.height(),this.bound={minx:0+t.edge.w,miny:0+t.edge.n,maxx:this.elw+t.edge.e,maxy:this.elh+t.edge.s}}}),e.registerFilter("backoff",a);var s=function(){this.core=null};t.extend(s.prototype,{tag:"constrain",priority:5,filter:function(t,e){return"move"==e?(t.x<this.minx&&(t.x=this.minx,t.x2=t.w+t.x),t.y<this.miny&&(t.y=this.miny,t.y2=t.h+t.y),t.x2>this.maxx&&(t.x2=this.maxx,t.x=t.x2-t.w),t.y2>this.maxy&&(t.y2=this.maxy,t.y=t.y2-t.h)):(t.x<this.minx&&(t.x=this.minx),t.y<this.miny&&(t.y=this.miny),t.x2>this.maxx&&(t.x2=this.maxx),t.y2>this.maxy&&(t.y2=this.maxy)),t.w=t.x2-t.x,t.h=t.y2-t.y,t},refresh:function(t){this.elw=t.core.container.width(),this.elh=t.core.container.height(),this.minx=0+t.edge.w,this.miny=0+t.edge.n,this.maxx=this.elw+t.edge.e,this.maxy=this.elh+t.edge.s}}),e.registerFilter("constrain",s);var c=function(){this.core=null};t.extend(c.prototype,{tag:"extent",priority:12,offsetFromCorner:function(t,e,r){var n=e[0],i=e[1];switch(t){case"bl":return[r.x2-n,r.y,n,i];case"tl":return[r.x2-n,r.y2-i,n,i];case"br":return[r.x,r.y,n,i];case"tr":return[r.x,r.y2-i,n,i]}},getQuadrant:function(t){var e=t.opposite[0]-t.offsetx,r=t.opposite[1]-t.offsety;return 0>e&&0>r?"br":e>=0&&r>=0?"tl":0>e&&r>=0?"tr":"bl"},filter:function(t,r,n){if("move"==r)return t;var i=t.w,o=t.h,a=n.state,s=this.limits,c=a?this.getQuadrant(a):"br";return s.minw&&i<s.minw&&(i=s.minw),s.minh&&o<s.minh&&(o=s.minh),s.maxw&&i>s.maxw&&(i=s.maxw),s.maxh&&o>s.maxh&&(o=s.maxh),i==t.w&&o==t.h?t:e.wrapFromXywh(this.offsetFromCorner(c,[i,o],t))},refresh:function(t){this.elw=t.core.container.width(),this.elh=t.core.container.height(),this.limits={minw:t.minSize[0],minh:t.minSize[1],maxw:t.maxSize[0],maxh:t.maxSize[1]}}}),e.registerFilter("extent",c);var u=function(){this.stepx=1,this.stepy=1,this.core=null};t.extend(u.prototype,{tag:"grid",priority:19,filter:function(t){var e={x:Math.round(t.x/this.stepx)*this.stepx,y:Math.round(t.y/this.stepy)*this.stepy,x2:Math.round(t.x2/this.stepx)*this.stepx,y2:Math.round(t.y2/this.stepy)*this.stepy};return e.w=e.x2-e.x,e.h=e.y2-e.y,e}}),e.registerFilter("grid",u);var h=function(){this.ratio=0,this.core=null};t.extend(h.prototype,{tag:"ratio",priority:15,offsetFromCorner:function(t,e,r){var n=e[0],i=e[1];switch(t){case"bl":return[r.x2-n,r.y,n,i];case"tl":return[r.x2-n,r.y2-i,n,i];case"br":return[r.x,r.y,n,i];case"tr":return[r.x,r.y2-i,n,i]}},getBoundRatio:function(t,r){var n=e.getLargestBox(this.ratio,t.w,t.h);return e.wrapFromXywh(this.offsetFromCorner(r,n,t))},getQuadrant:function(t){var e=t.opposite[0]-t.offsetx,r=t.opposite[1]-t.offsety;return 0>e&&0>r?"br":e>=0&&r>=0?"tl":0>e&&r>=0?"tr":"bl"},filter:function(t,e,r){if(!this.ratio)return t;var n=(t.w/t.h,r.state),i=n?this.getQuadrant(n):"br";if(e=e||"se","move"==e)return t;switch(e){case"n":t.x2=this.elw,t.w=t.x2-t.x,i="tr";break;case"s":t.x2=this.elw,t.w=t.x2-t.x,i="br";break;case"e":t.y2=this.elh,t.h=t.y2-t.y,i="br";break;case"w":t.y2=this.elh,t.h=t.y2-t.y,i="bl"}return this.getBoundRatio(t,i)},refresh:function(t){this.ratio=t.aspectRatio,this.elw=t.core.container.width(),this.elh=t.core.container.height()}}),e.registerFilter("ratio",h);var l=function(){this.core=null};t.extend(l.prototype,{tag:"round",priority:90,filter:function(t){var e={x:Math.round(t.x),y:Math.round(t.y),x2:Math.round(t.x2),y2:Math.round(t.y2)};return e.w=e.x2-e.x,e.h=e.y2-e.y,e}}),e.registerFilter("round",l);var f=function(t,e){this.color=e||"black",this.opacity=t||.5,this.core=null,this.shades={}};t.extend(f.prototype,{tag:"shader",fade:!0,fadeEasing:"swing",fadeSpeed:320,priority:95,init:function(){var e=this;e.attached||(e.visible=!1,e.container=t("<div />").addClass(e.core.opt.css_shades).prependTo(this.core.container).hide(),e.elh=this.core.container.height(),e.elw=this.core.container.width(),e.shades={top:e.createShade(),right:e.createShade(),left:e.createShade(),bottom:e.createShade()},e.attached=!0)},destroy:function(){this.container.remove()},setColor:function(r,n){var i=this;if(r==i.color)return i;this.color=r;var o=e.supportsColorFade();return t.each(i.shades,function(t,e){i.fade&&!n&&o?e.animate({backgroundColor:r},{queue:!1,duration:i.fadeSpeed,easing:i.fadeEasing}):e.css("backgroundColor",r)}),i},setOpacity:function(e,r){var n=this;return e==n.opacity?n:(n.opacity=e,t.each(n.shades,function(t,i){!n.fade||r?i.css({opacity:e}):i.animate({opacity:e},{queue:!1,duration:n.fadeSpeed,easing:n.fadeEasing})}),n)},createShade:function(){return t("<div />").css({position:"absolute",backgroundColor:this.color,opacity:this.opacity}).appendTo(this.container)},refresh:function(t){var e=this.core,r=this.shades;this.setColor(t.bgColor?t.bgColor:this.core.opt.bgColor),this.setOpacity(t.bgOpacity?t.bgOpacity:this.core.opt.bgOpacity),this.elh=e.container.height(),this.elw=e.container.width(),r.right.css("height",this.elh+"px"),r.left.css("height",this.elh+"px")},filter:function(t,e,r){if(!r.active)return t;var n=this,i=n.shades;return i.top.css({left:Math.round(t.x)+"px",width:Math.round(t.w)+"px",height:Math.round(t.y)+"px"}),i.bottom.css({top:Math.round(t.y2)+"px",left:Math.round(t.x)+"px",width:Math.round(t.w)+"px",height:n.elh-Math.round(t.y2)+"px"}),i.right.css({left:Math.round(t.x2)+"px",width:n.elw-Math.round(t.x2)+"px"}),i.left.css({width:Math.round(t.x)+"px"}),n.visible||(n.container.show(),n.visible=!0),t}}),e.registerFilter("shader",f);var p=function(t){this.stage=t,this.core=t.core,this.cloneStagePosition()};p.prototype={cloneStagePosition:function(){var t=this.stage;this.angle=t.angle,this.scale=t.scale,this.offset=t.offset},getElement:function(){var e=this.stage;return t("<div />").css({position:"absolute",top:e.offset[0]+"px",left:e.offset[1]+"px",width:e.angle+"px",height:e.scale+"px"})},animate:function(t){var e=this;this.scale=this.stage.boundScale(this.scale),e.stage.triggerEvent("croprotstart"),e.getElement().animate({top:e.offset[0]+"px",left:e.offset[1]+"px",width:e.angle+"px",height:e.scale+"px"},{easing:e.core.opt.animEasing,duration:e.core.opt.animDuration,complete:function(){e.stage.triggerEvent("croprotend"),"function"==typeof t&&t.call(this)},progress:function(t){var r,n={},i=t.tweens;for(r=0;r<i.length;r++)n[i[r].prop]=i[r].now;e.stage.setAngle(n.width).setScale(n.height).setOffset(n.top,n.left).redraw()}})}},e.stage.Canvas.prototype.getAnimator=function(){return new p(this)},e.registerComponent("CanvasAnimator",p);var d=function(t){this.selection=t,this.core=t.core};d.prototype={getElement:function(){var e=this.selection.get();return t("<div />").css({position:"absolute",top:e.y+"px",left:e.x+"px",width:e.w+"px",height:e.h+"px"})},animate:function(t,e,r,n,i){var o=this;o.selection.allowResize(!1),o.getElement().animate({top:e+"px",left:t+"px",width:r+"px",height:n+"px"},{easing:o.core.opt.animEasing,duration:o.core.opt.animDuration,complete:function(){o.selection.allowResize(!0),i&&i.call(this)},progress:function(t){var e,r={},n=t.tweens;for(e=0;e<n.length;e++)r[n[e].prop]=n[e].now;var i={x:parseInt(r.left),y:parseInt(r.top),w:parseInt(r.width),h:parseInt(r.height)};i.x2=i.x+i.w,i.y2=i.y+i.h,o.selection.updateRaw(i,"se")}})}},e.registerComponent("Animator",d);var g=function(t,e,r){var n=this;n.x=t.pageX,n.y=t.pageY,n.selection=e,n.eventTarget=e.core.opt.dragEventTarget,n.orig=e.get(),e.callFilterFunction("refresh");var i=e.core.container.position();n.elx=i.left,n.ely=i.top,n.offsetx=0,n.offsety=0,n.ord=r,n.opposite=n.getOppositeCornerOffset(),n.initEvents(t)};g.prototype={getOppositeCornerOffset:function(){var t=this.orig,e=this.x-this.elx-t.x,r=this.y-this.ely-t.y;switch(this.ord){case"nw":case"w":return[t.w-e,t.h-r];case"sw":return[t.w-e,-r];case"se":case"s":case"e":return[-e,-r];case"ne":case"n":return[-e,t.h-r]}return[null,null]},initEvents:function(e){t(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())},dragEvent:function(t){this.offsetx=t.pageX-this.x,this.offsety=t.pageY-this.y,this.selection.updateRaw(this.getBox(),this.ord)},endDragEvent:function(t){var e=this.selection;e.core.container.removeClass("jcrop-dragging"),e.element.trigger("cropend",[e,e.core.unscale(e.get())]),e.focus()},createStopHandler:function(){var e=this;return function(r){return t(e.eventTarget).off(".jcrop"),e.endDragEvent(r),!1}},createDragHandler:function(){var t=this;return function(e){return t.dragEvent(e),!1}},update:function(t,e){var r=this;r.offsetx=t-r.x,r.offsety=e-r.y},resultWrap:function(t){var e={x:Math.min(t[0],t[2]),y:Math.min(t[1],t[3]),x2:Math.max(t[0],t[2]),y2:Math.max(t[1],t[3])};return e.w=e.x2-e.x,e.h=e.y2-e.y,e},getBox:function(){var t=this,e=t.orig,r={x2:e.x+e.w,y2:e.y+e.h};switch(t.ord){case"n":return t.resultWrap([e.x,t.offsety+e.y,r.x2,r.y2]);case"s":return t.resultWrap([e.x,e.y,r.x2,t.offsety+r.y2]);case"e":return t.resultWrap([e.x,e.y,t.offsetx+r.x2,r.y2]);case"w":return t.resultWrap([e.x+t.offsetx,e.y,r.x2,r.y2]);case"sw":return t.resultWrap([t.offsetx+e.x,e.y,r.x2,t.offsety+r.y2]);case"se":return t.resultWrap([e.x,e.y,t.offsetx+r.x2,t.offsety+r.y2]);case"ne":return t.resultWrap([e.x,t.offsety+e.y,t.offsetx+r.x2,r.y2]);case"nw":return t.resultWrap([t.offsetx+e.x,t.offsety+e.y,r.x2,r.y2]);case"move":return r.nx=e.x+t.offsetx,r.ny=e.y+t.offsety,t.resultWrap([r.nx,r.ny,r.nx+e.w,r.ny+e.h])}}},e.registerComponent("DragState",g);var m=function(t){this.core=t};m.prototype={on:function(e,r){t(this).on(e,r)},off:function(e){t(this).off(e)},trigger:function(e){t(this).trigger(e)}},e.registerComponent("EventManager",m);var v=function(t,e,r){this.src=t,e||(e=new Image),this.element=e,this.callback=r,this.load()};t.extend(v,{attach:function(t,e){return new v(t.src,t,e)},prototype:{getDimensions:function(){var t=this.element;return t.naturalWidth?[t.naturalWidth,t.naturalHeight]:t.width?[t.width,t.height]:null},fireCallback:function(){this.element.onload=null,"function"==typeof this.callback&&this.callback.apply(this,this.getDimensions())},isLoaded:function(){return this.element.complete},load:function(){var t=this,e=t.element;e.src=t.src,t.isLoaded()?t.fireCallback():t.element.onload=function(e){t.fireCallback()}}}}),e.registerComponent("ImageLoader",v);var y=function(t){this.core=t,this.init()};t.extend(y,{support:function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)||void 0},prototype:{init:function(){var e=this,r=t.Jcrop.component.DragState.prototype;r.touch||(e.initEvents(),e.shimDragState(),e.shimStageDrag(),r.touch=!0)},shimDragState:function(){var e=this;t.Jcrop.component.DragState.prototype.initEvents=function(r){"touch"==r.type.substr(0,5)?t(this.eventTarget).on("touchmove.jcrop.jcrop-touch",e.dragWrap(this.createDragHandler())).on("touchend.jcrop.jcrop-touch",this.createStopHandler()):t(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())}},shimStageDrag:function(){this.core.container.addClass("jcrop-touch").on("touchstart.jcrop.jcrop-stage",this.dragWrap(this.core.ui.manager.startDragHandler()))},dragWrap:function(t){return function(e){return e.preventDefault(),e.stopPropagation(),"touch"==e.type.substr(0,5)&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,t(e))}},initEvents:function(){var t=this,e=t.core;e.container.on("touchstart.jcrop.jcrop-touch","."+e.opt.css_drag,t.dragWrap(e.startDrag()))}}}),e.registerComponent("Touch",y);var x=function(t){this.core=t,this.init()};t.extend(x,{defaults:{eventName:"keydown.jcrop",passthru:[9],debug:!1},prototype:{init:function(){t.extend(this,x.defaults),this.enable()},disable:function(){this.core.container.off(this.eventName)},enable:function(){var e=this,r=e.core;r.container.on(e.eventName,function(n){var i=n.shiftKey?16:2;if(t.inArray(n.keyCode,e.passthru)>=0)return!0;switch(n.keyCode){case 37:r.nudge(-i,0);break;case 38:r.nudge(0,-i);break;case 39:r.nudge(i,0);break;case 40:r.nudge(0,i);break;case 46:case 8:return r.requestDelete(),!1;default:e.debug&&void 0}n.metaKey||n.ctrlKey||n.preventDefault()})}}}),e.registerComponent("Keyboard",x);var w=function(){};t.extend(w,{defaults:{minSize:[8,8],maxSize:[0,0],aspectRatio:0,edge:{n:0,s:0,e:0,w:0},bgColor:null,bgOpacity:null,last:null,state:null,active:!0,linked:!0,canDelete:!0,canDrag:!0,canResize:!0,canSelect:!0},prototype:{init:function(t){this.core=t,this.startup(),this.linked=this.core.opt.linked,this.attach(),this.setOptions(this.core.opt),t.container.trigger("cropcreate",[this])},attach:function(){},startup:function(){var e=this,r=e.core.opt;t.extend(e,w.defaults),e.filter=e.core.getDefaultFilters(),e.element=t("<div />").addClass(r.css_selection).data({selection:e}),e.frame=t("<button />").addClass(r.css_button).data("ord","move").attr("type","button"),e.element.append(e.frame).appendTo(e.core.container),e.core.opt.is_msie&&e.frame.css({opacity:0,backgroundColor:"white"}),e.insertElements(),e.frame.on("focus.jcrop",function(t){e.core.setSelection(e),e.element.trigger("cropfocus",e),e.element.addClass("jcrop-focus")}).on("blur.jcrop",function(t){e.element.removeClass("jcrop-focus"),e.element.trigger("cropblur",e)})},propagate:["canDelete","canDrag","canResize","canSelect","minSize","maxSize","aspectRatio","edge"],setOptions:function(t){return e.propagate(this.propagate,t,this),this.refresh(),this},refresh:function(){this.allowResize(),this.allowDrag(),this.allowSelect(),this.callFilterFunction("refresh"),this.updateRaw(this.get(),"se")},callFilterFunction:function(t,e){for(var r=0;r<this.filter.length;r++)this.filter[r][t]&&this.filter[r][t](this);return this},addFilter:function(t){t.core=this.core,this.hasFilter(t)||(this.filter.push(t),this.sortFilters(),t.init&&t.init(),this.refresh())},hasFilter:function(t){var e,r=this.filter;for(e=0;e<r.length;e++)if(r[e]===t)return!0},sortFilters:function(){this.filter.sort(function(t,e){return t.priority-e.priority})},clearFilters:function(){for(var t,e=this.filter,t=0;t<e.length;t++)e[t].destroy&&e[t].destroy();this.filter=[]},removeFilter:function(t){for(var e,r=this.filter,n=[],e=0;e<r.length;e++)r[e].tag&&r[e].tag==t||t===r[e]?r[e].destroy&&r[e].destroy():n.push(r[e]);this.filter=n},runFilters:function(t,e){for(var r=0;r<this.filter.length;r++)t=this.filter[r].filter(t,e,this);return t},endDrag:function(){this.state&&(t(document.body).off(".jcrop"),this.focus(),this.state=null)},startDrag:function(r,n){var i=this;return i.core,n=n||t(r.target).data("ord"),this.focus(),("move"!=n||!i.element.hasClass(i.core.opt.css_nodrag))&&(this.state=new e.component.DragState(r,this,n),!1)},allowSelect:function(t){return void 0===t&&(t=this.canSelect),t&&this.canSelect?this.frame.attr("disabled",!1):this.frame.attr("disabled","disabled"),this},allowDrag:function(t){var e=this,r=e.core.opt;return void 0==t&&(t=e.canDrag),t&&e.canDrag?e.element.removeClass(r.css_nodrag):e.element.addClass(r.css_nodrag),this},allowResize:function(t){var e=this,r=e.core.opt;return void 0==t&&(t=e.canResize),t&&e.canResize?e.element.removeClass(r.css_noresize):e.element.addClass(r.css_noresize),this},remove:function(){this.element.trigger("cropremove",this),this.element.remove()},toBack:function(){this.active=!1,this.element.removeClass("jcrop-current jcrop-focus")},toFront:function(){this.active=!0,this.element.addClass("jcrop-current"),this.callFilterFunction("refresh"),this.refresh()},redraw:function(t){return this.moveTo(t.x,t.y),this.resize(t.w,t.h),this.last=t,this},update:function(t,e){return this.updateRaw(this.core.scale(t),e)},updateRaw:function(t,e){return t=this.runFilters(t,e),this.redraw(t),this.element.trigger("cropmove",[this,this.core.unscale(t)]),this},animateTo:function(t,r){var n=new e.component.Animator(this),i=this.core.scale(e.wrapFromXywh(t));n.animate(i.x,i.y,i.w,i.h,r)},center:function(t){var e=this.get(),r=this.core,n=r.container.width(),i=r.container.height(),o=[(n-e.w)/2,(i-e.h)/2,e.w,e.h];return this[t?"setSelect":"animateTo"](o)},createElement:function(e,r){return t("<div />").addClass(e+" ord-"+r).data("ord",r)},moveTo:function(t,e){this.element.css({top:e+"px",left:t+"px"})},blur:function(){return this.element.blur(),this},focus:function(){return this.core.setSelection(this),this.frame.focus(),this},resize:function(t,e){this.element.css({width:t+"px",height:e+"px"})},get:function(){var t=this.element,e=t.position(),r=t.width(),n=t.height(),i={x:e.left,y:e.top};return i.x2=i.x+r,i.y2=i.y+n,i.w=r,i.h=n,i},insertElements:function(){var t,e=this,r=(e.core,e.element),n=e.core.opt,i=n.borders,o=n.handles,a=n.dragbars;for(t=0;t<a.length;t++)r.append(e.createElement(n.css_dragbars,a[t]));for(t=0;t<o.length;t++)r.append(e.createElement(n.css_handles,o[t]));for(t=0;t<i.length;t++)r.append(e.createElement(n.css_borders,i[t]))}}}),e.registerComponent("Selection",w);var b=function(e,r){t.extend(this,b.defaults,r||{}),this.manager=e,this.core=e.core};b.defaults={offset:[-8,-8],active:!0,minsize:[20,20]},t.extend(b.prototype,{start:function(r){var n=this.core;if(n.opt.allowSelect){if(n.opt.multi&&n.opt.multiMax&&n.ui.multi.length>=n.opt.multiMax)return!1;var i=t(r.currentTarget).offset(),o=r.pageX-i.left+this.offset[0],a=r.pageY-i.top+this.offset[1],s=n.ui.multi;if(!n.opt.multi)if(n.opt.multiCleanup){for(var c=0;c<s.length;c++)s[c].remove();n.ui.multi=[]}else n.removeSelection(n.ui.selection);n.container.addClass("jcrop-dragging");var u=n.newSelection().updateRaw(e.wrapFromXywh([o,a,1,1]));return u.element.trigger("cropstart",[u,this.core.unscale(u.get())]),u.startDrag(r,"se")}},end:function(t,e){this.drag(t,e);var r=this.sel.get();this.core.container.removeClass("jcrop-dragging"),r.w<this.minsize[0]||r.h<this.minsize[1]?this.core.requestDelete():this.sel.focus()}}),e.registerComponent("StageDrag",b);var S=function(t){this.core=t,this.ui=t.ui,this.init()};t.extend(S.prototype,{init:function(){this.setupEvents(),this.dragger=new b(this)},tellConfigUpdate:function(t){for(var e=0,r=this.ui.multi,n=r.length;n>e;e++)r[e].setOptions&&(r[e].linked||this.core.opt.linkCurrent&&r[e]==this.ui.selection)&&r[e].setOptions(t)},startDragHandler:function(){var t=this;return function(e){return!e.button||t.core.opt.is_ie_lt9?t.dragger.start(e):void 0}},removeEvents:function(){this.core.event.off(".jcrop-stage"),this.core.container.off(".jcrop-stage")},shimLegacyHandlers:function(e){var r,n=this.core;t.each(n.opt.legacyHandlers,function(t,i){t in e&&(r=e[t],n.container.off(".jcrop-"+t).on(i+".jcrop.jcrop-"+t,function(t,e,i){r.call(n,i)}),delete e[t])})},setupEvents:function(){var t=this,e=t.core;e.event.on("configupdate.jcrop-stage",function(r){t.shimLegacyHandlers(e.opt),t.tellConfigUpdate(e.opt),e.container.trigger("cropconfig",[e,e.opt])}),this.core.container.on("mousedown.jcrop.jcrop-stage",this.startDragHandler())}}),e.registerComponent("StageManager",S);var C=function(){};t.extend(C,{defaults:{selection:null,fading:!0,fadeDelay:1e3,fadeDuration:1e3,autoHide:!1,width:80,height:80,_hiding:null},prototype:{recopyCanvas:function(){var t=this.core.ui.stage,e=t.context;this.context.putImageData(e.getImageData(0,0,t.canvas.width,t.canvas.height),0,0)},init:function(e,r){var n=this;this.core=e,t.extend(this,C.defaults,r),n.initEvents(),n.refresh(),n.insertElements(),n.selection?(n.renderSelection(n.selection),n.selectionTarget=n.selection.element[0]):n.core.ui.selection&&n.renderSelection(n.core.ui.selection),n.core.ui.stage.canvas&&(n.context=n.preview[0].getContext("2d"),n.core.container.on("cropredraw",function(t){n.recopyCanvas(),n.refresh()}))},updateImage:function(e){return this.preview.remove(),this.preview=t(t.Jcrop.imageClone(e)),this.element.append(this.preview),this.refresh(),this},insertElements:function(){this.preview=t(t.Jcrop.imageClone(this.core.ui.stage.imgsrc)),this.element=t("<div />").addClass("jcrop-thumb").width(this.width).height(this.height).append(this.preview).appendTo(this.core.container)},resize:function(t,e){this.width=t,this.height=e,this.element.width(t).height(e),this.renderCoords(this.last)},refresh:function(){this.cw=this.core.opt.xscale*this.core.container.width(),this.ch=this.core.opt.yscale*this.core.container.height(),this.last&&this.renderCoords(this.last)},renderCoords:function(t){var e=this.width/t.w,r=this.height/t.h;return this.preview.css({width:Math.round(e*this.cw)+"px",height:Math.round(r*this.ch)+"px",marginLeft:"-"+Math.round(e*t.x)+"px",marginTop:"-"+Math.round(r*t.y)+"px"}),this.last=t,this},renderSelection:function(t){return this.renderCoords(t.core.unscale(t.get()))},selectionStart:function(t){this.renderSelection(t)},show:function(){this._hiding&&clearTimeout(this._hiding),this.fading?this.element.stop().animate({opacity:1},{duration:80,queue:!1}):this.element.stop().css({opacity:1})},hide:function(){var t=this;t.fading?t._hiding=setTimeout(function(){t._hiding=null,t.element.stop().animate({opacity:0},{duration:t.fadeDuration,queue:!1})},t.fadeDelay):t.element.hide()},initEvents:function(){var t=this;t.core.container.on("croprotstart croprotend cropimage cropstart cropmove cropend",function(e,r,n){if(t.selectionTarget&&t.selectionTarget!==e.target)return!1;switch(e.type){case"cropimage":t.updateImage(n);break;case"cropstart":t.selectionStart(r);case"croprotstart":t.show();break;case"cropend":t.renderCoords(n);case"croprotend":t.autoHide&&t.hide();break;case"cropmove":t.renderCoords(n)}})}}}),e.registerComponent("Thumbnailer",C);var T=function(){};T.prototype={init:function(e,r,n){r||(r=e.container),this.$btn=t(r),this.$targ=t(r),this.core=e,this.$btn.addClass("dialdrag").on("mousedown.dialdrag",this.mousedown()).data("dialdrag",this),t.isFunction(n)||(n=function(){}),this.callback=n,this.ondone=n},remove:function(){return this.$btn.removeClass("dialdrag").off(".dialdrag").data("dialdrag",null),this},setTarget:function(e){return this.$targ=t(e),this},getOffset:function(){var t=this.$targ,e=t.offset();return[e.left+t.width()/2,e.top+t.height()/2]},relMouse:function(t){var e=t.pageX-this.offset[0],r=t.pageY-this.offset[1],n=Math.atan2(r,e)*(180/Math.PI),i=Math.sqrt(Math.pow(e,2)+Math.pow(r,2));return[e,r,n,i]},mousedown:function(){function e(e){t(window).off(".dialdrag"),n.ondone.call(n,n.relMouse(e)),n.core.container.trigger("croprotend")}function r(t){n.callback.call(n,n.relMouse(t))}var n=this;return function(i){n.offset=n.getOffset();var o=n.relMouse(i);return n.angleOffset=-n.core.ui.stage.angle+o[2],n.distOffset=o[3],n.dragOffset=[o[0],o[1]],n.core.container.trigger("croprotstart"),t(window).on("mousemove.dialdrag",r).on("mouseup.dialdrag",e),n.callback.call(n,n.relMouse(i)),!1}}},e.registerComponent("DialDrag",T),e.defaults={edge:{n:0,s:0,e:0,w:0},setSelect:null,linked:!0,linkCurrent:!0,canDelete:!0,canSelect:!0,canDrag:!0,canResize:!0,eventManagerComponent:e.component.EventManager,keyboardComponent:e.component.Keyboard,dragstateComponent:e.component.DragState,stagemanagerComponent:e.component.StageManager,animatorComponent:e.component.Animator,selectionComponent:e.component.Selection,stageConstructor:e.stageConstructor,allowSelect:!0,multi:!1,multiMax:!1,multiCleanup:!0,animation:!0,animEasing:"swing",animDuration:400,fading:!0,fadeDuration:300,fadeEasing:"swing",bgColor:"black",bgOpacity:.5,applyFilters:["constrain","extent","backoff","ratio","shader","round"],borders:["e","w","s","n"],handles:["n","s","e","w","sw","ne","nw","se"],dragbars:["n","e","w","s"],dragEventTarget:window,xscale:1,yscale:1,boxWidth:null,boxHeight:null,css_nodrag:"jcrop-nodrag",css_drag:"jcrop-drag",css_container:"jcrop-active",css_shades:"jcrop-shades",css_selection:"jcrop-selection",css_borders:"jcrop-border",css_handles:"jcrop-handle jcrop-drag",css_button:"jcrop-box jcrop-drag",css_noresize:"jcrop-noresize",css_dragbars:"jcrop-dragbar jcrop-drag",legacyHandlers:{onChange:"cropmove",onSelect:"cropend"}},t.extend(e.prototype,{init:function(){this.event=new this.opt.eventManagerComponent(this),this.ui.keyboard=new this.opt.keyboardComponent(this),this.ui.manager=new this.opt.stagemanagerComponent(this),this.applyFilters(),t.Jcrop.supportsTouch&&new t.Jcrop.component.Touch(this),this.initEvents()},applySizeConstraints:function(){var r=this.opt,n=this.opt.imgsrc;if(n){var i=n.naturalWidth||n.width,o=n.naturalHeight||n.height,a=r.boxWidth||i,s=r.boxHeight||o;if(n&&(i>a||o>s)){var c=e.getLargestBox(i/o,a,s);t(n).width(c[0]).height(c[1]),this.resizeContainer(c[0],c[1]),this.opt.xscale=i/c[0],this.opt.yscale=o/c[1]}}if(this.opt.trueSize){var u=this.opt.trueSize[0],h=this.opt.trueSize[1],l=this.getContainerSize();this.opt.xscale=u/l[0],this.opt.yscale=h/l[1]}},initComponent:function(t){if(e.component[t]){var r=Array.prototype.slice.call(arguments),n=new e.component[t];return r.shift(),r.unshift(this),n.init.apply(n,r),n}},setOptions:function(e,r){return t.isPlainObject(e)||(e={}),t.extend(this.opt,e),this.opt.setSelect&&(this.ui.multi.length||this.newSelection(),this.setSelect(this.opt.setSelect),this.opt.setSelect=null),this.event.trigger("configupdate"),this},destroy:function(){this.opt.imgsrc?(this.container.before(this.opt.imgsrc),this.container.remove(),t(this.opt.imgsrc).removeData("Jcrop").show()):this.container.remove()},applyFilters:function(){for(var e,r=0,n=this.opt.applyFilters,i=n.length;i>r;r++)t.Jcrop.filter[n[r]]&&(e=new t.Jcrop.filter[n[r]]),e.core=this,e.init&&e.init(),this.filter[n[r]]=e},getDefaultFilters:function(){for(var t=[],e=0,r=this.opt.applyFilters,n=r.length;n>e;e++)this.filter.hasOwnProperty(r[e])&&t.push(this.filter[r[e]]);return t.sort(function(t,e){return t.priority-e.priority}),t},setSelection:function(t){for(var e=this.ui.multi,r=[],n=0;n<e.length;n++)e[n]!==t&&r.push(e[n]),e[n].toBack();return r.unshift(t),this.ui.multi=r,this.ui.selection=t,t.toFront(),t},getSelection:function(t){var e=this.ui.selection.get();return e},newSelection:function(t){return t||(t=new this.opt.selectionComponent),t.init(this),this.setSelection(t),t},hasSelection:function(t){for(var e=0;e<this.ui.multi;e++)if(t===this.ui.multi[e])return!0},removeSelection:function(t){for(var e,r=[],n=this.ui.multi,e=0;e<n.length;e++)t!==n[e]?r.push(n[e]):n[e].remove();return this.ui.multi=r},addFilter:function(t){for(var e=0,r=this.ui.multi,n=r.length;n>e;e++)r[e].addFilter(t);return this},removeFilter:function(t){for(var e=0,r=this.ui.multi,n=r.length;n>e;e++)r[e].removeFilter(t);return this},blur:function(){return this.ui.selection.blur(),this},focus:function(){return this.ui.selection.focus(),this},initEvents:function(){var t=this;t.container.on("selectstart",function(t){return!1}).on("mousedown","."+t.opt.css_drag,t.startDrag())},maxSelect:function(){this.setSelect([0,0,this.elw,this.elh])},nudge:function(t,e){var r=this.ui.selection,n=r.get();n.x+=t,n.x2+=t,n.y+=e,n.y2+=e,n.x<0?(n.x2=n.w,n.x=0):n.x2>this.elw&&(n.x2=this.elw,n.x=n.x2-n.w),n.y<0?(n.y2=n.h,n.y=0):n.y2>this.elh&&(n.y2=this.elh,n.y=n.y2-n.h),r.element.trigger("cropstart",[r,this.unscale(n)]),r.updateRaw(n,"move"),r.element.trigger("cropend",[r,this.unscale(n)])},refresh:function(){for(var t=0,e=this.ui.multi,r=e.length;r>t;t++)e[t].refresh()},blurAll:function(){for(var t=this.ui.multi,e=0;e<t.length;e++)t[e]!==sel&&n.push(t[e]),t[e].toBack()},scale:function(t){var e=this.opt.xscale,r=this.opt.yscale;return{x:t.x/e,y:t.y/r,x2:t.x2/e,y2:t.y2/r,w:t.w/e,h:t.h/r}},unscale:function(t){
var e=this.opt.xscale,r=this.opt.yscale;return{x:t.x*e,y:t.y*r,x2:t.x2*e,y2:t.y2*r,w:t.w*e,h:t.h*r}},requestDelete:function(){return this.ui.multi.length>1&&this.ui.selection.canDelete?this.deleteSelection():void 0},deleteSelection:function(){this.ui.selection&&(this.removeSelection(this.ui.selection),this.ui.multi.length&&this.ui.multi[0].focus(),this.ui.selection.refresh())},animateTo:function(t){return this.ui.selection&&this.ui.selection.animateTo(t),this},setSelect:function(t){return this.ui.selection&&this.ui.selection.update(e.wrapFromXywh(t)),this},startDrag:function(){var e=this;return function(r){var n=t(r.target),i=n.closest("."+e.opt.css_selection).data("selection"),o=n.data("ord");return e.container.trigger("cropstart",[i,e.unscale(i.get())]),i.startDrag(r,o),!1}},getContainerSize:function(){return[this.container.width(),this.container.height()]},resizeContainer:function(t,e){this.container.width(t).height(e),this.refresh()},setImage:function(e,r){var n=this,i=n.opt.imgsrc;return!!i&&void new t.Jcrop.component.ImageLoader(e,null,function(o,a){n.resizeContainer(o,a),i.src=e,t(i).width(o).height(a),n.applySizeConstraints(),n.refresh(),n.container.trigger("cropimage",[n,i]),"function"==typeof r&&r.call(n,o,a)})},update:function(t){this.ui.selection&&this.ui.selection.update(t)}}),t.fn.Jcrop=function(e,r){e=e||{};var n=this.eq(0).data("Jcrop"),i=Array.prototype.slice.call(arguments);return"api"==e?n:n&&"string"==typeof e?!!n[e]&&(i.shift(),n[e].apply(n,i),n):void this.each(function(){var n=t(this),i=n.data("Jcrop");return i?i.setOptions(e):(e.stageConstructor||(e.stageConstructor=t.Jcrop.stageConstructor),e.stageConstructor(this,e,function(e,i){var o=i.setSelect;o&&delete i.setSelect;var a=t.Jcrop.attach(e.element,i);"function"==typeof e.attach&&e.attach(a),n.data("Jcrop",a),o&&(a.newSelection(),a.setSelect(o)),"function"==typeof r&&r.call(a)})),this})};var j=function(t,e,r){function n(t){v.cssText=t}function i(t,e){return typeof t===e}function o(t,e){return!!~(""+t).indexOf(e)}function a(t,e){for(var n in t){var i=t[n];if(!o(i,"-")&&v[i]!==r)return"pfx"!=e||i}return!1}function s(t,e,n){for(var o in t){var a=e[t[o]];if(a!==r)return n===!1?t[o]:i(a,"function")?a.bind(n||e):a}return!1}function c(t,e,r){var n=t.charAt(0).toUpperCase()+t.slice(1),o=(t+" "+b.join(n+" ")+n).split(" ");return i(e,"string")||i(e,"undefined")?a(o,e):(o=(t+" "+S.join(n+" ")+n).split(" "),s(o,e,r))}var u,h,l,f="2.7.1",p={},d=e.documentElement,g="modernizr",m=e.createElement(g),v=m.style,y={}.toString,x=" -webkit- -moz- -o- -ms- ".split(" "),w="Webkit Moz O ms",b=w.split(" "),S=w.toLowerCase().split(" "),C={svg:"http://www.w3.org/2000/svg"},T={},j=[],D=j.slice,E=function(t,r,n,i){var o,a,s,c,u=e.createElement("div"),h=e.body,l=h||e.createElement("body");if(parseInt(n,10))for(;n--;)s=e.createElement("div"),s.id=i?i[n]:g+(n+1),u.appendChild(s);return o=["&#173;",'<style id="s',g,'">',t,"</style>"].join(""),u.id=g,(h?u:l).innerHTML+=o,l.appendChild(u),h||(l.style.background="",l.style.overflow="hidden",c=d.style.overflow,d.style.overflow="hidden",d.appendChild(l)),a=r(u,t),h?u.parentNode.removeChild(u):(l.parentNode.removeChild(l),d.style.overflow=c),!!a},k=function(){function t(t,o){o=o||e.createElement(n[t]||"div"),t="on"+t;var a=t in o;return a||(o.setAttribute||(o=e.createElement("div")),o.setAttribute&&o.removeAttribute&&(o.setAttribute(t,""),a=i(o[t],"function"),i(o[t],"undefined")||(o[t]=r),o.removeAttribute(t))),o=null,a}var n={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return t}(),M={}.hasOwnProperty;l=i(M,"undefined")||i(M.call,"undefined")?function(t,e){return e in t&&i(t.constructor.prototype[e],"undefined")}:function(t,e){return M.call(t,e)},Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;if("function"!=typeof e)throw new TypeError;var r=D.call(arguments,1),n=function(){if(this instanceof n){var i=function(){};i.prototype=e.prototype;var o=new i,a=e.apply(o,r.concat(D.call(arguments)));return Object(a)===a?a:o}return e.apply(t,r.concat(D.call(arguments)))};return n}),T.canvas=function(){var t=e.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},T.canvastext=function(){return!(!p.canvas||!i(e.createElement("canvas").getContext("2d").fillText,"function"))},T.touch=function(){var r;return"ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch?r=!0:E(["@media (",x.join("touch-enabled),("),g,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(t){r=9===t.offsetTop}),r},T.draganddrop=function(){var t=e.createElement("div");return"draggable"in t||"ondragstart"in t&&"ondrop"in t},T.csstransforms=function(){return!!c("transform")},T.svg=function(){return!!e.createElementNS&&!!e.createElementNS(C.svg,"svg").createSVGRect},T.inlinesvg=function(){var t=e.createElement("div");return t.innerHTML="<svg/>",(t.firstChild&&t.firstChild.namespaceURI)==C.svg},T.svgclippaths=function(){return!!e.createElementNS&&/SVGClipPath/.test(y.call(e.createElementNS(C.svg,"clipPath")))};for(var F in T)l(T,F)&&(h=F.toLowerCase(),p[h]=T[F](),j.push((p[h]?"":"no-")+h));return p.addTest=function(t,e){if("object"==typeof t)for(var n in t)l(t,n)&&p.addTest(n,t[n]);else{if(t=t.toLowerCase(),p[t]!==r)return p;e="function"==typeof e?e():e,"undefined"!=typeof enableClasses&&enableClasses&&(d.className+=" "+(e?"":"no-")+t),p[t]=e}return p},n(""),m=u=null,p._version=f,p._prefixes=x,p._domPrefixes=S,p._cssomPrefixes=b,p.hasEvent=k,p.testProp=function(t){return a([t])},p.testAllProps=c,p.testStyles=E,p}(window,window.document);!function(){var t=new Image;t.onerror=function(){j.addTest("datauri",function(){return!1})},t.onload=function(){j.addTest("datauri",function(){return 1==t.width&&1==t.height})},t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}(),t.Jcrop=e,t.Jcrop.supportsCanvas=j.canvas,t.Jcrop.supportsCanvasText=j.canvastext,t.Jcrop.supportsDragAndDrop=j.draganddrop,t.Jcrop.supportsDataURI=j.datauri,t.Jcrop.supportsSVG=j.svg,t.Jcrop.supportsInlineSVG=j.inlinesvg,t.Jcrop.supportsSVGClipPaths=j.svgclippaths,t.Jcrop.supportsCSSTransforms=j.csstransforms,t.Jcrop.supportsTouch=j.touch}(jQuery),!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(t){"use strict";function e(e){var r=e.data;e.isDefaultPrevented()||(e.preventDefault(),t(e.target).ajaxSubmit(r))}function r(e){var r=e.target,n=t(r);if(!n.is("[type=submit],[type=image]")){var i=n.closest("[type=submit]");if(0===i.length)return;r=i[0]}var o=this;if(o.clk=r,"image"==r.type)if(void 0!==e.offsetX)o.clk_x=e.offsetX,o.clk_y=e.offsetY;else if("function"==typeof t.fn.offset){var a=n.offset();o.clk_x=e.pageX-a.left,o.clk_y=e.pageY-a.top}else o.clk_x=e.pageX-r.offsetLeft,o.clk_y=e.pageY-r.offsetTop;setTimeout(function(){o.clk=o.clk_x=o.clk_y=null},100)}function n(){if(t.fn.ajaxSubmit.debug){var e="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(e):window.opera&&window.opera.postError&&window.opera.postError(e)}}var i={};i.fileapi=void 0!==t("<input type='file'/>").get(0).files,i.formdata=void 0!==window.FormData;var o=!!t.fn.prop;t.fn.attr2=function(){if(!o)return this.attr.apply(this,arguments);var t=this.prop.apply(this,arguments);return t&&t.jquery||"string"==typeof t?t:this.attr.apply(this,arguments)},t.fn.ajaxSubmit=function(e){function r(r){var n,i,o=t.param(r,e.traditional).split("&"),a=o.length,s=[];for(n=0;a>n;n++)o[n]=o[n].replace(/\+/g," "),i=o[n].split("="),s.push([decodeURIComponent(i[0]),decodeURIComponent(i[1])]);return s}function a(n){for(var i=new FormData,o=0;o<n.length;o++)i.append(n[o].name,n[o].value);if(e.extraData){var a=r(e.extraData);for(o=0;o<a.length;o++)a[o]&&i.append(a[o][0],a[o][1])}e.data=null;var s=t.extend(!0,{},t.ajaxSettings,e,{contentType:!1,processData:!1,cache:!1,type:c||"POST"});e.uploadProgress&&(s.xhr=function(){var r=t.ajaxSettings.xhr();return r.upload&&r.upload.addEventListener("progress",function(t){var r=0,n=t.loaded||t.position,i=t.total;t.lengthComputable&&(r=Math.ceil(n/i*100)),e.uploadProgress(t,n,i,r)},!1),r}),s.data=null;var u=s.beforeSend;return s.beforeSend=function(t,r){r.data=e.formData?e.formData:i,u&&u.call(this,t,r)},t.ajax(s)}function s(r){function i(t){var e=null;try{t.contentWindow&&(e=t.contentWindow.document)}catch(r){n("cannot get iframe.contentWindow document: "+r)}if(e)return e;try{e=t.contentDocument?t.contentDocument:t.document}catch(r){n("cannot get iframe.contentDocument: "+r),e=t.document}return e}function a(){function e(){try{var t=i(v).readyState;n("state = "+t),t&&"uninitialized"==t.toLowerCase()&&setTimeout(e,50)}catch(r){n("Server abort: ",r," (",r.name,")"),s(D),S&&clearTimeout(S),S=void 0}}var r=l.attr2("target"),o=l.attr2("action"),a="multipart/form-data",u=l.attr("enctype")||l.attr("encoding")||a;C.setAttribute("target",d),(!c||/post/i.test(c))&&C.setAttribute("method","POST"),o!=f.url&&C.setAttribute("action",f.url),f.skipEncodingOverride||c&&!/post/i.test(c)||l.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),f.timeout&&(S=setTimeout(function(){b=!0,s(j)},f.timeout));var h=[];try{if(f.extraData)for(var p in f.extraData)f.extraData.hasOwnProperty(p)&&h.push(t.isPlainObject(f.extraData[p])&&f.extraData[p].hasOwnProperty("name")&&f.extraData[p].hasOwnProperty("value")?t('<input type="hidden" name="'+f.extraData[p].name+'">').val(f.extraData[p].value).appendTo(C)[0]:t('<input type="hidden" name="'+p+'">').val(f.extraData[p]).appendTo(C)[0]);f.iframeTarget||m.appendTo("body"),v.attachEvent?v.attachEvent("onload",s):v.addEventListener("load",s,!1),setTimeout(e,15);try{C.submit()}catch(g){var y=document.createElement("form").submit;y.apply(C)}}finally{C.setAttribute("action",o),C.setAttribute("enctype",u),r?C.setAttribute("target",r):l.removeAttr("target"),t(h).remove()}}function s(e){if(!y.aborted&&!A){if(F=i(v),F||(n("cannot access response document"),e=D),e===j&&y)return y.abort("timeout"),void T.reject(y,"timeout");if(e==D&&y)return y.abort("server abort"),void T.reject(y,"error","server abort");if(F&&F.location.href!=f.iframeSrc||b){v.detachEvent?v.detachEvent("onload",s):v.removeEventListener("load",s,!1);var r,o="success";try{if(b)throw"timeout";var a="xml"==f.dataType||F.XMLDocument||t.isXMLDoc(F);if(n("isXml="+a),!a&&window.opera&&(null===F.body||!F.body.innerHTML)&&--_)return n("requeing onLoad callback, DOM not available"),void setTimeout(s,250);var c=F.body?F.body:F.documentElement;y.responseText=c?c.innerHTML:null,y.responseXML=F.XMLDocument?F.XMLDocument:F,a&&(f.dataType="xml"),y.getResponseHeader=function(t){var e={"content-type":f.dataType};return e[t.toLowerCase()]},c&&(y.status=Number(c.getAttribute("status"))||y.status,y.statusText=c.getAttribute("statusText")||y.statusText);var u=(f.dataType||"").toLowerCase(),h=/(json|script|text)/.test(u);if(h||f.textarea){var l=F.getElementsByTagName("textarea")[0];if(l)y.responseText=l.value,y.status=Number(l.getAttribute("status"))||y.status,y.statusText=l.getAttribute("statusText")||y.statusText;else if(h){var d=F.getElementsByTagName("pre")[0],g=F.getElementsByTagName("body")[0];d?y.responseText=d.textContent?d.textContent:d.innerText:g&&(y.responseText=g.textContent?g.textContent:g.innerText)}}else"xml"==u&&!y.responseXML&&y.responseText&&(y.responseXML=O(y.responseText));try{M=L(y,u,f)}catch(x){o="parsererror",y.error=r=x||o}}catch(x){n("error caught: ",x),o="error",y.error=r=x||o}y.aborted&&(n("upload aborted"),o=null),y.status&&(o=y.status>=200&&y.status<300||304===y.status?"success":"error"),"success"===o?(f.success&&f.success.call(f.context,M,"success",y),T.resolve(y.responseText,"success",y),p&&t.event.trigger("ajaxSuccess",[y,f])):o&&(void 0===r&&(r=y.statusText),f.error&&f.error.call(f.context,y,o,r),T.reject(y,"error",r),p&&t.event.trigger("ajaxError",[y,f,r])),p&&t.event.trigger("ajaxComplete",[y,f]),p&&!--t.active&&t.event.trigger("ajaxStop"),f.complete&&f.complete.call(f.context,y,o),A=!0,f.timeout&&clearTimeout(S),setTimeout(function(){f.iframeTarget?m.attr("src",f.iframeSrc):m.remove(),y.responseXML=null},100)}}}var u,h,f,p,d,m,v,y,x,w,b,S,C=l[0],T=t.Deferred();if(T.abort=function(t){y.abort(t)},r)for(h=0;h<g.length;h++)u=t(g[h]),o?u.prop("disabled",!1):u.removeAttr("disabled");if(f=t.extend(!0,{},t.ajaxSettings,e),f.context=f.context||f,d="jqFormIO"+(new Date).getTime(),f.iframeTarget?(m=t(f.iframeTarget),w=m.attr2("name"),w?d=w:m.attr2("name",d)):(m=t('<iframe name="'+d+'" src="'+f.iframeSrc+'" />'),m.css({position:"absolute",top:"-1000px",left:"-1000px"})),v=m[0],y={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(e){var r="timeout"===e?"timeout":"aborted";n("aborting upload... "+r),this.aborted=1;try{v.contentWindow.document.execCommand&&v.contentWindow.document.execCommand("Stop")}catch(i){}m.attr("src",f.iframeSrc),y.error=r,f.error&&f.error.call(f.context,y,r,e),p&&t.event.trigger("ajaxError",[y,f,r]),f.complete&&f.complete.call(f.context,y,r)}},p=f.global,p&&0===t.active++&&t.event.trigger("ajaxStart"),p&&t.event.trigger("ajaxSend",[y,f]),f.beforeSend&&f.beforeSend.call(f.context,y,f)===!1)return f.global&&t.active--,T.reject(),T;if(y.aborted)return T.reject(),T;x=C.clk,x&&(w=x.name,w&&!x.disabled&&(f.extraData=f.extraData||{},f.extraData[w]=x.value,"image"==x.type&&(f.extraData[w+".x"]=C.clk_x,f.extraData[w+".y"]=C.clk_y)));var j=1,D=2,E=t("meta[name=csrf-token]").attr("content"),k=t("meta[name=csrf-param]").attr("content");k&&E&&(f.extraData=f.extraData||{},f.extraData[k]=E),f.forceSync?a():setTimeout(a,10);var M,F,A,_=50,O=t.parseXML||function(t,e){return window.ActiveXObject?(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t)):e=(new DOMParser).parseFromString(t,"text/xml"),e&&e.documentElement&&"parsererror"!=e.documentElement.nodeName?e:null},z=t.parseJSON||function(t){return window.eval("("+t+")")},L=function(e,r,n){var i=e.getResponseHeader("content-type")||"",o="xml"===r||!r&&i.indexOf("xml")>=0,a=o?e.responseXML:e.responseText;return o&&"parsererror"===a.documentElement.nodeName&&t.error&&t.error("parsererror"),n&&n.dataFilter&&(a=n.dataFilter(a,r)),"string"==typeof a&&("json"===r||!r&&i.indexOf("json")>=0?a=z(a):("script"===r||!r&&i.indexOf("javascript")>=0)&&t.globalEval(a)),a};return T}if(!this.length)return n("ajaxSubmit: skipping submit process - no element selected"),this;var c,u,h,l=this;"function"==typeof e?e={success:e}:void 0===e&&(e={}),c=e.type||this.attr2("method"),u=e.url||this.attr2("action"),h="string"==typeof u?t.trim(u):"",h=h||window.location.href||"",h&&(h=(h.match(/^([^#]+)/)||[])[1]),e=t.extend(!0,{url:h,success:t.ajaxSettings.success,type:c||t.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},e);var f={};if(this.trigger("form-pre-serialize",[this,e,f]),f.veto)return n("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(e.beforeSerialize&&e.beforeSerialize(this,e)===!1)return n("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var p=e.traditional;void 0===p&&(p=t.ajaxSettings.traditional);var d,g=[],m=this.formToArray(e.semantic,g);if(e.data&&(e.extraData=e.data,d=t.param(e.data,p)),e.beforeSubmit&&e.beforeSubmit(m,this,e)===!1)return n("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[m,this,e,f]),f.veto)return n("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var v=t.param(m,p);d&&(v=v?v+"&"+d:d),"GET"==e.type.toUpperCase()?(e.url+=(e.url.indexOf("?")>=0?"&":"?")+v,e.data=null):e.data=v;var y=[];if(e.resetForm&&y.push(function(){l.resetForm()}),e.clearForm&&y.push(function(){l.clearForm(e.includeHidden)}),!e.dataType&&e.target){var x=e.success||function(){};y.push(function(r){var n=e.replaceTarget?"replaceWith":"html";t(e.target)[n](r).each(x,arguments)})}else e.success&&y.push(e.success);if(e.success=function(t,r,n){for(var i=e.context||this,o=0,a=y.length;a>o;o++)y[o].apply(i,[t,r,n||l,l])},e.error){var w=e.error;e.error=function(t,r,n){var i=e.context||this;w.apply(i,[t,r,n,l])}}if(e.complete){var b=e.complete;e.complete=function(t,r){var n=e.context||this;b.apply(n,[t,r,l])}}var S=t("input[type=file]:enabled",this).filter(function(){return""!==t(this).val()}),C=S.length>0,T="multipart/form-data",j=l.attr("enctype")==T||l.attr("encoding")==T,D=i.fileapi&&i.formdata;n("fileAPI :"+D);var E,k=(C||j)&&!D;e.iframe!==!1&&(e.iframe||k)?e.closeKeepAlive?t.get(e.closeKeepAlive,function(){E=s(m)}):E=s(m):E=(C||j)&&D?a(m):t.ajax(e),l.removeData("jqxhr").data("jqxhr",E);for(var M=0;M<g.length;M++)g[M]=null;return this.trigger("form-submit-notify",[this,e]),this},t.fn.ajaxForm=function(i){if(i=i||{},i.delegation=i.delegation&&t.isFunction(t.fn.on),!i.delegation&&0===this.length){var o={s:this.selector,c:this.context};return!t.isReady&&o.s?(n("DOM not ready, queuing ajaxForm"),t(function(){t(o.s,o.c).ajaxForm(i)}),this):(n("terminating; zero elements found by selector"+(t.isReady?"":" (DOM not ready)")),this)}return i.delegation?(t(document).off("submit.form-plugin",this.selector,e).off("click.form-plugin",this.selector,r).on("submit.form-plugin",this.selector,i,e).on("click.form-plugin",this.selector,i,r),this):this.ajaxFormUnbind().bind("submit.form-plugin",i,e).bind("click.form-plugin",i,r)},t.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},t.fn.formToArray=function(e,r){var n=[];if(0===this.length)return n;var o,a=this[0],s=this.attr("id"),c=e?a.getElementsByTagName("*"):a.elements;if(c&&!/MSIE [678]/.test(navigator.userAgent)&&(c=t(c).get()),s&&(o=t(':input[form="'+s+'"]').get(),o.length&&(c=(c||[]).concat(o))),!c||!c.length)return n;var u,h,l,f,p,d,g;for(u=0,d=c.length;d>u;u++)if(p=c[u],l=p.name,l&&!p.disabled)if(e&&a.clk&&"image"==p.type)a.clk==p&&(n.push({name:l,value:t(p).val(),type:p.type}),n.push({name:l+".x",value:a.clk_x},{name:l+".y",value:a.clk_y}));else if(f=t.fieldValue(p,!0),f&&f.constructor==Array)for(r&&r.push(p),h=0,g=f.length;g>h;h++)n.push({name:l,value:f[h]});else if(i.fileapi&&"file"==p.type){r&&r.push(p);var m=p.files;if(m.length)for(h=0;h<m.length;h++)n.push({name:l,value:m[h],type:p.type});else n.push({name:l,value:"",type:p.type})}else null!==f&&"undefined"!=typeof f&&(r&&r.push(p),n.push({name:l,value:f,type:p.type,required:p.required}));if(!e&&a.clk){var v=t(a.clk),y=v[0];l=y.name,l&&!y.disabled&&"image"==y.type&&(n.push({name:l,value:v.val()}),n.push({name:l+".x",value:a.clk_x},{name:l+".y",value:a.clk_y}))}return n},t.fn.formSerialize=function(e){return t.param(this.formToArray(e))},t.fn.fieldSerialize=function(e){var r=[];return this.each(function(){var n=this.name;if(n){var i=t.fieldValue(this,e);if(i&&i.constructor==Array)for(var o=0,a=i.length;a>o;o++)r.push({name:n,value:i[o]});else null!==i&&"undefined"!=typeof i&&r.push({name:this.name,value:i})}}),t.param(r)},t.fn.fieldValue=function(e){for(var r=[],n=0,i=this.length;i>n;n++){var o=this[n],a=t.fieldValue(o,e);null===a||"undefined"==typeof a||a.constructor==Array&&!a.length||(a.constructor==Array?t.merge(r,a):r.push(a))}return r},t.fieldValue=function(e,r){var n=e.name,i=e.type,o=e.tagName.toLowerCase();if(void 0===r&&(r=!0),r&&(!n||e.disabled||"reset"==i||"button"==i||("checkbox"==i||"radio"==i)&&!e.checked||("submit"==i||"image"==i)&&e.form&&e.form.clk!=e||"select"==o&&-1==e.selectedIndex))return null;if("select"==o){var a=e.selectedIndex;if(0>a)return null;for(var s=[],c=e.options,u="select-one"==i,h=u?a+1:c.length,l=u?a:0;h>l;l++){var f=c[l];if(f.selected){var p=f.value;if(p||(p=f.attributes&&f.attributes.value&&!f.attributes.value.specified?f.text:f.value),u)return p;s.push(p)}}return s}return t(e).val()},t.fn.clearForm=function(e){return this.each(function(){t("input,select,textarea",this).clearFields(e)})},t.fn.clearFields=t.fn.clearInputs=function(e){var r=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var n=this.type,i=this.tagName.toLowerCase();r.test(n)||"textarea"==i?this.value="":"checkbox"==n||"radio"==n?this.checked=!1:"select"==i?this.selectedIndex=-1:"file"==n?/MSIE/.test(navigator.userAgent)?t(this).replaceWith(t(this).clone(!0)):t(this).val(""):e&&(e===!0&&/hidden/.test(n)||"string"==typeof e&&t(this).is(e))&&(this.value="")})},t.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},t.fn.enable=function(t){return void 0===t&&(t=!0),this.each(function(){this.disabled=!t})},t.fn.selected=function(e){return void 0===e&&(e=!0),this.each(function(){var r=this.type;if("checkbox"==r||"radio"==r)this.checked=e;else if("option"==this.tagName.toLowerCase()){var n=t(this).parent("select");e&&n[0]&&"select-one"==n[0].type&&n.find("option").selected(!1),this.selected=e}})},t.fn.ajaxSubmit.debug=!1});